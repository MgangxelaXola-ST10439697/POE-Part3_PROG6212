@model ContractMonthlyClaimSystem.Models.WorkClaim

@{
    ViewData["Title"] = "Submit New Claim";
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">
                        <i class="bi bi-file-earmark-plus"></i> Submit New Work Claim
                    </h3>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i>
                            <strong>Note:</strong> Your personal details and rate are pre-filled from your profile.
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Name" class="form-label">First Name</label>
                                <input asp-for="Name" class="form-control" readonly />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="Surname" class="form-label">Surname</label>
                                <input asp-for="Surname" class="form-control" readonly />
                                <span asp-validation-for="Surname" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Department" class="form-label">Department</label>
                            <input asp-for="Department" class="form-control" readonly />
                            <span asp-validation-for="Department" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="RatePerJob" class="form-label">Rate per Job (R)</label>
                            <div class="input-group">
                                <span class="input-group-text">R</span>
                                <input asp-for="RatePerJob" class="form-control" readonly />
                            </div>
                            <span asp-validation-for="RatePerJob" class="text-danger"></span>
                            <small class="form-text text-muted">Your default rate from your employee profile</small>
                        </div>

                        <div class="mb-3">
                            <label asp-for="NumberOfJobs" class="form-label">
                                Number of Jobs Completed <span class="text-danger">*</span>
                            </label>
                            <input asp-for="NumberOfJobs" class="form-control" type="number" min="1"
                                   placeholder="Enter number of jobs completed" id="numberOfJobs" />
                            <span asp-validation-for="NumberOfJobs" class="text-danger"></span>
                        </div>

                        <div class="alert alert-success" id="totalAmountDisplay">
                            <strong>Total Amount to be Claimed:</strong>
                            <h4 class="mb-0">R <span id="calculatedTotal">0.00</span></h4>
                            <small class="text-muted">Calculated as: Rate per Job × Number of Jobs</small>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a asp-action="MyClaims" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> Submit Claim
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Auto-calculate total amount
        document.addEventListener('DOMContentLoaded', function() {
            const rateInput = document.querySelector('input[name="RatePerJob"]');
            const jobsInput = document.getElementById('numberOfJobs');
            const totalDisplay = document.getElementById('calculatedTotal');

            function calculateTotal() {
                const rate = parseFloat(rateInput.value) || 0;
                const jobs = parseInt(jobsInput.value) || 0;
                const total = rate * jobs;
                totalDisplay.textContent = total.toFixed(2);
            }

            jobsInput.addEventListener('input', calculateTotal);
            calculateTotal(); // Initial calculation
        });
    </script>
}