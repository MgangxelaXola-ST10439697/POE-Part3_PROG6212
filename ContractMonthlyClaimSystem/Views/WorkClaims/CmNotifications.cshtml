@model IEnumerable<ContractMonthlyClaimSystem.Models.Notification>

@{
    ViewData["Title"] = "CM Notifications";
}

<div class="container">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2>
                <i class="bi bi-bell-fill"></i> Construction Manager Notifications
            </h2>
            <p class="text-muted">System notifications and alerts</p>
        </div>
        <div class="col-md-4 text-end">
            <a asp-action="CmReviewList" class="btn btn-outline-primary">
                <i class="bi bi-building"></i> Back to Review List
            </a>
        </div>
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-success shadow-sm">
            <i class="bi bi-check-circle-fill"></i>
            <strong>Inbox Clear!</strong> You have no unread notifications.
        </div>

        <div class="text-center py-5">
            <i class="bi bi-bell-slash display-1 text-muted opacity-50"></i>
            <p class="text-muted mt-3 fs-5">No notifications at this time</p>
            <p class="text-muted">You'll be notified here when there are updates requiring your attention.</p>
        </div>
    }
    else
    {
        <div class="alert alert-warning shadow-sm">
            <div class="d-flex align-items-center">
                <i class="bi bi-exclamation-triangle-fill fs-3 me-3"></i>
                <div>
                    <strong>Action Required:</strong> You have <strong>@Model.Count()</strong> unread notification(s).
                </div>
            </div>
        </div>

        @foreach (var note in Model)
        {
            <div class="card shadow-sm mb-3">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <div class="bg-warning bg-opacity-25 rounded-circle p-3">
                                <i class="bi bi-info-circle-fill fs-2 text-warning"></i>
                            </div>
                        </div>
                        <div class="col">
                            <h5 class="card-title mb-2">
                                System Notification
                            </h5>
                            <p class="card-text mb-2">
                                @note.Message
                            </p>
                            <p class="text-muted small mb-0">
                                <i class="bi bi-clock"></i>
                                @note.CreatedAt.ToString("dd MMMM yyyy 'at' HH:mm")

                                @if (note.WorkClaimId.HasValue)
                                {
                                    <span class="ms-3">
                                        <i class="bi bi-file-earmark"></i>
                                        Related to <strong>Claim #@note.WorkClaimId</strong>
                                    </span>
                                }
                            </p>
                        </div>
                        <div class="col-auto">
                            <a asp-action="CmMarkNotificationRead" asp-route-id="@note.Id"
                               class="btn btn-success"
                               onclick="return confirm('Mark this notification as read?')">
                                <i class="bi bi-check2-circle"></i> Mark as Read
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }

        <div class="card shadow-sm mt-4">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="bi bi-question-circle"></i> About CM Notifications
                </h5>
            </div>
            <div class="card-body">
                <p><strong>What are these notifications?</strong></p>
                <p>
                    As a Construction Manager, you receive notifications when:
                </p>
                <ul>
                    <li>Claims require your review and approval</li>
                    <li>There are issues with claim processing</li>
                    <li>Project Managers need guidance on claim decisions</li>
                    <li>System updates affect claim workflows</li>
                </ul>
                <p class="mb-0">
                    <strong>Tip:</strong> Mark notifications as read once you've taken the required action
                    to keep your inbox organized.
                </p>
            </div>
        </div>
    }
</div>